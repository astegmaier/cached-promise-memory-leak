<!DOCTYPE html>
<html>
  <head>
    <title>Cached Promises Memory Leak</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/a11y-light.min.css"
      integrity="sha512-WDk6RzwygsN9KecRHAfm9HTN87LQjqdygDmkHSJxVkVI7ErCZ8ZWxP6T8RvBujY1n2/E4Ac+bn2ChXnp5rnnHA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <div class="container">
      <a href="../index.html">&lt; Back</a>
      <h1 class="display-2">
        A Variant of the Bug With Async Function Closures
      </h1>
      <p class="lead">
        This example modifies the original one to instead capture
        <code>MyClass</code> in the closure of an async function that awaits a
        cached promise. You see the same leak in the original example.
      </p>
      <p>
        <button class="btn btn-primary" id="make-class-leak">
          Create a new class and make it leak
        </button>
      </p>
      <p>Clicking the button above will run this code:</p>
      <pre
        class="p-3 border border-secondary-subtle rounded-3"
      ><code class="language-javascript" id="code"></code></pre>
    </div>
    <script src="./async-function-closures.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"
      integrity="sha512-bgHRAiTjGrzHzLyKOnpFvaEpGzJet3z4tZnXGjpsCcqOnAH6VGUx9frc5bcIhKTVLEiCO6vEhNAgx5jtLUYrfA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      fetch("./async-function-closures.js")
        .then((response) => response.text())
        .then((code) => (document.getElementById("code").textContent = code))
        .then(() => hljs.highlightAll());
    </script>
  </body>
</html>
